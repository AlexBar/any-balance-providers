var byteUtils={hexChar:"0123456789ABCDEF".split(""),getRandomByte:function(){return Math.floor(1/(Math.random()*Math.random()+Math.random()+1)*255)},getRandomBytes:function(b){if("undefined"!=typeof window.crypto)return this.getCryptoRandomBytes(b);for(var c=Array(b),a=0;a<b;a++)c[a]=this.getRandomByte();return c},getCryptoRandomBytes:function(b){b=new Uint8Array(b);window.crypto.getRandomValues(b);return[].slice.call(b)},getRandomByteHEX:function(){return this.byteToHex(this.getRandomByte())},getRandomBytesHEX:function(b){return byteUtils.bytesToHex(this.getRandomBytes(b))},
getCryptoRandomBytesHEX:function(b){return byteUtils.bytesToHex(this.getCryptoRandomBytes(b))},xorHEX:function(b,c){for(var a="",d=0;d<b.length;d+=2)a+=this.byteToHex(this.hex2byte(b[d]+b[d+1])^this.hex2byte(c[d]+c[d+1]));return a},byteToHex:function(b){return this.hexChar[b>>4&15]+this.hexChar[b&15]},bytesToHex:function(b){for(var c="",a=0;a<b.length;a++)c+=this.byteToHex(b[a]);return c},hex2byte:function(b){return parseInt(b,16)},hex2bytes:function(b){for(var c=[];2<=b.length;)c.push(this.hex2byte(b.substring(0,
2))),b=b.substring(2,b.length);return c},int2bytes:function(b){return""+this.byteToHex(b>>24&255)+this.byteToHex(b>>16&255)+this.byteToHex(b>>8&255)+this.byteToHex(b&255)},wordArrayToBytes:function(b){var c=b.words;b=b.sigBytes;for(var a=new Uint8Array(b),d=0;d<b;d++)a[d]=c[d>>>2]>>>24-d%4*8&255;return a},getRandomInt:function(){if("undefined"!=typeof window.crypto){var b=new Int32Array(1);window.crypto.getRandomValues(b);return Math.abs(Math.floor(b[0]))}return Math.floor(Math.random()*INT_MAX)},
getRandomIntBounded:function(b,c){if(b>=c)throw"Минимальное значение должно быть строго меньше максимального";var a=this.getRandomInt();return Math.floor((c-b)/INT_MAX*a+b)}},INT_MAX=2147483647;var Auth={INT_ONE:"00000001",CLIENT_KEY_STR:"",SERVER_KEY_STR:"",hashType:"SHA-512",exports:{saltedPassword:"",authMessage:"",clientProof:""},init:function(b,c){this.CLIENT_KEY_STR=b;this.SERVER_KEY_STR=c},hi:function(b,c,a){for(var d=c=this.getHmac(b,"HEX",c+Auth.INT_ONE,"HEX"),g=1;g<a;g++)d=this.getHmac(b,"HEX",d,"HEX"),c=byteUtils.xorHEX(c,d);return c},"getnonсeC":function(){return byteUtils.getRandomBytesHEX(32)},getSalt:function(){return byteUtils.getRandomBytesHEX(32)},getIterationCount:function(){return byteUtils.getRandomIntBounded(4096,
5E3)},getAuthMessage:function(b,c,a,d,g){for(var f="",h=0;h<b.length;h++)f+=byteUtils.byteToHex(b.charCodeAt(h));f=f+c+a+byteUtils.int2bytes(d);for(h=0;h<g.length;h++)f+=byteUtils.byteToHex(g.charCodeAt(h));return f},getClientProof:function(b,c,a,d,g,f){this.exports.saltedPassword=this.hi(c,a,d);c=this.getHmac(this.exports.saltedPassword,"HEX",this.CLIENT_KEY_STR,"HEX");var h=this.getHash(c);this.exports.authMessage=this.getAuthMessage(b,g,a,d,f);b=this.getHmac(h,"HEX",this.exports.authMessage,"HEX");
this.exports.clientProof=byteUtils.xorHEX(c,b);return this.exports.clientProof},checkServerSignature:function(b){var c=this.getHmac(this.exports.saltedPassword,"HEX",this.SERVER_KEY_STR,"HEX");return this.getHmac(c,"HEX",this.exports.authMessage,"HEX")==b},getMd5Hash:function(b){return CryptoJS.MD5(b).toString()},getHash:function(b){var c=new jsSHA(this.hashType,"HEX");c.update(b);return c.getHash("HEX")},getHmac:function(b,c,a,d){d=new jsSHA(this.hashType,d);d.setHMACKey(b,c);d.update(a);return d.getHMAC("HEX")},
getHMacHex:function(b,c){var a=new jsSHA(this.hashType,"TEXT");a.setHMACKey(b,"HEX");a.update(c);return a.getHMAC("HEX")},getHMacHexHex:function(b,c){var a=new jsSHA(this.hashType,"HEX");a.setHMACKey(b,"HEX");a.update(c);return a.getHMAC("HEX")}};(function(b){function c(a,b,c){var d=0,n=[],f=0,g,e,I,G,r,p,E,t=!1,l=!1,y=[],v=[],A,B=!1;c=c||{};g=c.encoding||"UTF8";A=c.numRounds||1;I=k(b,g);if(A!==parseInt(A,10)||1>A)throw Error("numRounds must a integer >= 1");p=function(b,c){return F(b,c,a)};E=function(b,c,m,d){var x,n;if("SHA-384"===a||"SHA-512"===a)x=(c+129>>>10<<5)+31,n=32;else throw Error("Unexpected error in SHA-2 implementation");for(;b.length<=x;)b.push(0);b[c>>>5]|=128<<24-c%32;b[x]=c+m;m=b.length;for(c=0;c<m;c+=n)d=F(b.slice(c,c+n),
d,a);if("SHA-384"===a)b=[d[0].a,d[0].b,d[1].a,d[1].b,d[2].a,d[2].b,d[3].a,d[3].b,d[4].a,d[4].b,d[5].a,d[5].b];else if("SHA-512"===a)b=[d[0].a,d[0].b,d[1].a,d[1].b,d[2].a,d[2].b,d[3].a,d[3].b,d[4].a,d[4].b,d[5].a,d[5].b,d[6].a,d[6].b,d[7].a,d[7].b];else throw Error("Unexpected error in SHA-2 implementation");return b};if("SHA-384"===a)r=1024,G=384;else if("SHA-512"===a)r=1024,G=512;else throw Error("Chosen SHA variant is not supported");e=C(a);this.setHMACKey=function(b,c,m){var x;if(!0===l)throw Error("HMAC key already set");
if(!0===t)throw Error("Cannot set HMAC key after finalizing hash");if(!0===B)throw Error("Cannot set HMAC key after calling update");g=(m||{}).encoding||"UTF8";c=k(c,g)(b);b=c.binLen;c=c.value;x=r>>>3;m=x/4-1;if(x<b/8){for(c=E(c,b,0,C(a));c.length<=m;)c.push(0);c[m]&=4294967040}else if(x>b/8){for(;c.length<=m;)c.push(0);c[m]&=4294967040}for(b=0;b<=m;b+=1)y[b]=c[b]^909522486,v[b]=c[b]^1549556828;e=p(y,e);d=r;l=!0};this.update=function(a){var b,c,m,w=0,x=r>>>5;b=I(a,n,f);a=b.binLen;c=b.value;b=a>>>
5;for(m=0;m<b;m+=x)w+r<=a&&(e=p(c.slice(m,m+x),e),w+=r);d+=w;n=c.slice(w>>>5);f=a%r;B=!0};this.getHash=function(b,c){var m;if(!0===l)throw Error("Cannot call getHash after setting HMAC key");m=q(c);switch(b){case "HEX":b=function(a){return h(a,m)};break;case "B64":b=function(a){return u(a,m)};break;case "BYTES":b=z;break;default:throw Error("format must be HEX, B64, or BYTES");}if(!1===t)for(e=E(n,f,d,e),c=1;c<A;c+=1)e=E(e,G,0,C(a));t=!0;return b(e)};this.getHMAC=function(b,c){var m,x;if(!1===l)throw Error("Cannot call getHMAC without first setting HMAC key");
x=q(c);switch(b){case "HEX":b=function(a){return h(a,x)};break;case "B64":b=function(a){return u(a,x)};break;case "BYTES":b=z;break;default:throw Error("outputFormat must be HEX, B64, or BYTES");}!1===t&&(m=E(n,f,d,e),e=p(v,C(a)),e=E(m,G,r,e));t=!0;return b(e)}}function a(a,b){this.a=a;this.b=b}function d(a,b,c){var d=a.length,n,e,f,g,h;b=b||[0];c=c||0;h=c>>>3;if(0!==d%2)throw Error("String of HEX type must be in byte increments");for(n=0;n<d;n+=2){e=parseInt(a.substr(n,2),16);if(isNaN(e))throw Error("String of HEX type contains invalid characters");
g=(n>>>1)+h;for(f=g>>>2;b.length<=f;)b.push(0);b[f]|=e<<8*(3-g%4)}return{value:b,binLen:4*d+c}}function g(a,b,c){var d,n,e,f,g;d=b||[0];c=c||0;e=c>>>3;for(n=0;n<a.length;n+=1)b=a.charCodeAt(n),g=n+e,f=g>>>2,d.length<=f&&d.push(0),d[f]|=b<<8*(3-g%4);return{value:d,binLen:8*a.length+c}}function f(a,b,c){var d,n=0,e,f,g,h,k,r;d=b||[0];c=c||0;b=c>>>3;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");f=a.indexOf("=");a=a.replace(/\=/g,"");if(-1!==f&&f<a.length)throw Error("Invalid '=' found in base-64 string");
for(f=0;f<a.length;f+=4){k=a.substr(f,4);for(g=h=0;g<k.length;g+=1)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(k[g]),h|=e<<18-6*g;for(g=0;g<k.length-1;g+=1){r=n+b;for(e=r>>>2;d.length<=e;)d.push(0);d[e]|=(h>>>16-8*g&255)<<8*(3-r%4);n+=1}}return{value:d,binLen:8*n+c}}function h(a,b){var c="",d=4*a.length,e,f;for(e=0;e<d;e+=1)f=a[e>>>2]>>>8*(3-e%4),c+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15);return b.outputUpper?c.toUpperCase():c}function u(a,
b){var c="",d=4*a.length,e,f,g;for(e=0;e<d;e+=3)for(g=e+1>>>2,f=a.length<=g?0:a[g],g=e+2>>>2,g=a.length<=g?0:a[g],g=(a[e>>>2]>>>8*(3-e%4)&255)<<16|(f>>>8*(3-(e+1)%4)&255)<<8|g>>>8*(3-(e+2)%4)&255,f=0;4>f;f+=1)8*e+6*f<=32*a.length?c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6*(3-f)&63):c+=b.b64Pad;return c}function z(a){var b="",c=4*a.length,d,e;for(d=0;d<c;d+=1)e=a[d>>>2]>>>8*(3-d%4)&255,b+=String.fromCharCode(e);return b}function q(a){var b={outputUpper:!1,b64Pad:"="};
a=a||{};b.outputUpper=a.outputUpper||!1;!0===a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function k(a,b){switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(a){case "HEX":a=d;break;case "TEXT":a=function(a,c,d){var e,f,g=0,w,h,k,p,l;e=c||[0];
c=d||0;k=c>>>3;if("UTF8"===b)for(w=0;w<a.length;w+=1)for(d=a.charCodeAt(w),f=[],128>d?f.push(d):2048>d?(f.push(192|d>>>6),f.push(128|d&63)):55296>d||57344<=d?f.push(224|d>>>12,128|d>>>6&63,128|d&63):(w+=1,d=65536+((d&1023)<<10|a.charCodeAt(w)&1023),f.push(240|d>>>18,128|d>>>12&63,128|d>>>6&63,128|d&63)),h=0;h<f.length;h+=1){l=g+k;for(p=l>>>2;e.length<=p;)e.push(0);e[p]|=f[h]<<8*(3-l%4);g+=1}else if("UTF16BE"===b||"UTF16LE"===b)for(w=0;w<a.length;w+=1){d=a.charCodeAt(w);"UTF16LE"===b&&(h=d&255,d=h<<
8|d>>>8);l=g+k;for(p=l>>>2;e.length<=p;)e.push(0);e[p]|=d<<8*(2-l%4);g+=2}return{value:e,binLen:8*g+c}};break;case "B64":a=f;break;case "BYTES":a=g;break;default:throw Error("format must be HEX, TEXT, B64, or BYTES");}return a}function l(b,c){b=new a(b.a,b.b);return 32>=c?new a(b.a>>>c|b.b<<32-c&4294967295,b.b>>>c|b.a<<32-c&4294967295):new a(b.b>>>c-32|b.a<<64-c&4294967295,b.a>>>c-32|b.b<<64-c&4294967295)}function v(b,c){return 32>=c?new a(b.a>>>c,b.b>>>c|b.a<<32-c&4294967295):new a(0,b.a>>>c-32)}
function H(b,c,d){return new a(b.a&c.a^~b.a&d.a,b.b&c.b^~b.b&d.b)}function B(b,c,d){return new a(b.a&c.a^b.a&d.a^c.a&d.a,b.b&c.b^b.b&d.b^c.b&d.b)}function Q(b){var c=l(b,28),d=l(b,34);b=l(b,39);return new a(c.a^d.a^b.a,c.b^d.b^b.b)}function R(b){var c=l(b,14),d=l(b,18);b=l(b,41);return new a(c.a^d.a^b.a,c.b^d.b^b.b)}function S(b){var c=l(b,1),d=l(b,8);b=v(b,7);return new a(c.a^d.a^b.a,c.b^d.b^b.b)}function T(b){var c=l(b,19),d=l(b,61);b=v(b,6);return new a(c.a^d.a^b.a,c.b^d.b^b.b)}function U(b,c){var d,
e,f;d=(b.b&65535)+(c.b&65535);e=(b.b>>>16)+(c.b>>>16)+(d>>>16);f=(e&65535)<<16|d&65535;d=(b.a&65535)+(c.a&65535)+(e>>>16);e=(b.a>>>16)+(c.a>>>16)+(d>>>16);return new a((e&65535)<<16|d&65535,f)}function V(b,c,d,e){var f,g,h;f=(b.b&65535)+(c.b&65535)+(d.b&65535)+(e.b&65535);g=(b.b>>>16)+(c.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f>>>16);h=(g&65535)<<16|f&65535;f=(b.a&65535)+(c.a&65535)+(d.a&65535)+(e.a&65535)+(g>>>16);g=(b.a>>>16)+(c.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f>>>16);return new a((g&65535)<<16|f&65535,
h)}function W(b,c,d,e,f){var g,h,k;g=(b.b&65535)+(c.b&65535)+(d.b&65535)+(e.b&65535)+(f.b&65535);h=(b.b>>>16)+(c.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f.b>>>16)+(g>>>16);k=(h&65535)<<16|g&65535;g=(b.a&65535)+(c.a&65535)+(d.a&65535)+(e.a&65535)+(f.a&65535)+(h>>>16);h=(b.a>>>16)+(c.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f.a>>>16)+(g>>>16);return new a((h&65535)<<16|g&65535,k)}function C(b){var c,d;c=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];d=[1779033703,3144134277,1013904242,
2773480762,1359893119,2600822924,528734635,1541459225];switch(b){case "SHA-224":b=c;break;case "SHA-256":b=d;break;case "SHA-384":b=[new a(3418070365,c[0]),new a(1654270250,c[1]),new a(2438529370,c[2]),new a(355462360,c[3]),new a(1731405415,c[4]),new a(41048885895,c[5]),new a(3675008525,c[6]),new a(1203062813,c[7])];break;case "SHA-512":b=[new a(d[0],4089235720),new a(d[1],2227873595),new a(d[2],4271175723),new a(d[3],1595750129),new a(d[4],2917565137),new a(d[5],725511199),new a(d[6],4215389547),
new a(d[7],327033209)];break;default:throw Error("Unknown SHA variant");}return b}function F(b,c,d){var e,f,g,h,k,l,q,r,p,u,t,v,y,z,A,C,F,J,K,L,M,N,D=[],O;if("SHA-384"===d||"SHA-512"===d)u=80,v=2,N=a,y=U,z=V,A=W,C=S,F=T,J=Q,K=R,M=B,L=H,O=P;else throw Error("Unexpected error in SHA-2 implementation");d=c[0];e=c[1];f=c[2];g=c[3];h=c[4];k=c[5];l=c[6];q=c[7];for(t=0;t<u;t+=1)16>t?(p=t*v,r=b.length<=p?0:b[p],p=b.length<=p+1?0:b[p+1],D[t]=new N(r,p)):D[t]=z(F(D[t-2]),D[t-7],C(D[t-15]),D[t-16]),r=A(q,K(h),
L(h,k,l),O[t],D[t]),p=y(J(d),M(d,e,f)),q=l,l=k,k=h,h=y(g,r),g=f,f=e,e=d,d=y(r,p);c[0]=y(d,c[0]);c[1]=y(e,c[1]);c[2]=y(f,c[2]);c[3]=y(g,c[3]);c[4]=y(h,c[4]);c[5]=y(k,c[5]);c[6]=y(l,c[6]);c[7]=y(q,c[7]);return c}var e,P;e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,
2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];P=[new a(e[0],3609767458),new a(e[1],602891725),new a(e[2],3964484399),new a(e[3],2173295548),
new a(e[4],4081628472),new a(e[5],3053834265),new a(e[6],2937671579),new a(e[7],3664609560),new a(e[8],2734883394),new a(e[9],1164996542),new a(e[10],1323610764),new a(e[11],3590304994),new a(e[12],4068182383),new a(e[13],991336113),new a(e[14],633803317),new a(e[15],3479774868),new a(e[16],2666613458),new a(e[17],944711139),new a(e[18],2341262773),new a(e[19],2007800933),new a(e[20],1495990901),new a(e[21],1856431235),new a(e[22],3175218132),new a(e[23],2198950837),new a(e[24],3999719339),new a(e[25],
766784016),new a(e[26],2566594879),new a(e[27],3203337956),new a(e[28],1034457026),new a(e[29],2466948901),new a(e[30],3758326383),new a(e[31],168717936),new a(e[32],1188179964),new a(e[33],1546045734),new a(e[34],1522805485),new a(e[35],2643833823),new a(e[36],2343527390),new a(e[37],1014477480),new a(e[38],1206759142),new a(e[39],344077627),new a(e[40],1290863460),new a(e[41],3158454273),new a(e[42],3505952657),new a(e[43],106217008),new a(e[44],3606008344),new a(e[45],1432725776),new a(e[46],1467031594),
new a(e[47],851169720),new a(e[48],3100823752),new a(e[49],1363258195),new a(e[50],3750685593),new a(e[51],3785050280),new a(e[52],3318307427),new a(e[53],3812723403),new a(e[54],2003034995),new a(e[55],3602036899),new a(e[56],1575990012),new a(e[57],1125592928),new a(e[58],2716904306),new a(e[59],442776044),new a(e[60],593698344),new a(e[61],3733110249),new a(e[62],2999351573),new a(e[63],3815920427),new a(3391569614,3928383900),new a(3515267271,566280711),new a(3940187606,3454069534),new a(4118630271,
4000239992),new a(116418474,1914138554),new a(174292421,2731055270),new a(289380356,3203993006),new a(460393269,320620315),new a(685471733,587496836),new a(852142971,1086792851),new a(1017036298,365543100),new a(1126000580,2618297676),new a(1288033470,3409855158),new a(1501505948,4234509866),new a(1607167915,987167468),new a(1816402316,1246189591)];"function"===typeof define&&define.amd?define(function(){return c}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=
exports=c:exports=c:b.jsSHA=c})(this);var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36"},baseurl="https://online.mkb.ru/";
function cryptParams(b,c){var a=AnyBalance.getPreferences(),d=a.login,a=a.password;"undefined"==typeof window&&(window={});var g=getJsonObject(b,/var\s+PageConfig\s*=\s*/);if(!g)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти ключи авторизации. Сайт изменен?");Auth.init(g.ClientKey,g.ServerKey);b=Auth.getMd5Hash(a);a=Auth.getnon\u0441eC();g=AnyBalance.requestPost(baseurl+"auth?m=l",JSON.stringify({l:d,nc:a}),addHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json; charset=UTF-8",
Referer:baseurl+"secure/login.aspx?ReturnUrl=%2fsecure%2fmain.aspx"}));a=getJson(g).d;if(!a)throw AnyBalance.trace(g),new AnyBalance.Error("Не удалось получить ключи авторизации. Сайт изменен?");a=getJson(a);b=Auth.getClientProof(d,b,a.Salt,a.IterationsCount,a.NonceS,a.SessionId);var d={sid:a.SessionId,l:d,cp:b,ns:a.NonceS,am:Auth.exports.authMessage,sp:Auth.exports.saltedPassword},f;for(f in d)c[f]=d[f];c.txtPassword=""}
function login(b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");checkEmpty(!b.num||/^\d{4}$/.test(b.num),"Укажите 4 последних цифры или не указывайте ничего, чтобы получить информацию по первому продукту.");var c=AnyBalance.requestGet(baseurl+"secure/main.aspx",g_headers);if(!c||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(c),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");
if(/logout/i.test(c))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{getElement(c,/<form[^>]+name="login"[^>]*>/i);var a=createFormParams(c,function(a,c,d,u){return"txtLogin"==d?b.login:"txtPassword"==d?b.password:"__EVENTTARGET"==d?"btnLoginStandard":u});cryptParams(c,a);c=AnyBalance.requestPost(baseurl+"secure/login.aspx?ReturnUrl=%2fsecure%2fmain.aspx",a,addHeaders({Referer:baseurl+"secure/login.aspx?ReturnUrl=%2fsecure%2fmain.aspx"}))}if(/<input[^>]+name="txtCode"/i.test(c)){AnyBalance.trace("Потребовался ввод кода.");
var d=getElement(c,/<p[^>]*msgSMSCode[^>]*/i,replaceTagsAndSpaces);getElement(c,/<form[^>]+name="login"[^>]*>/i);a=createFormParams(c,function(a,b,c,u){return"txtCode"==c?AnyBalance.retrieveCode((d||"Пожалуйста, введите код из SMS для входа в интернет-банк.")+'\n\nЧтобы каждый раз не вводить код, вы можете отключить его в своём интернет банке: меню "Настройки системы"/"Настройки информирования"/"Информирование об операциях в системе", затем снять галочку "Запрашивать SMS-код подтверждения при входе". Это безопасно, код подтверждения всё равно будет требоваться для всех операций.',
null,{inputType:"number",time:3E5}):"__EVENTTARGET"==c?"btnLoginSMS":u});c=AnyBalance.requestPost(baseurl+"secure/login.aspx?a=2&returnurl=",a,addHeaders({Referer:baseurl+"secure/login.aspx"}))}if(!/logout/i.test(c)){if(a=getParam(c,null,null,/<div[^>]+id="errMessage"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Проверьте правильность указания Логина и Пароля/i.test(a));AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");
}__setLoginSuccessful();return c}function processAccounts(b,c){if(AnyBalance.isAvailable("accounts")){b=AnyBalance.requestGet(baseurl+"secure/accounts.aspx",g_headers);b=getParam(b,null,null,/var\s+accountdata\s*=\s*(\[[^\]]+\])/i,null,getJson);AnyBalance.trace("Найдено счетов: "+b.length);c.accounts=[];for(var a=0;a<b.length;++a){var d=b[a],g=d.benefacc,g={__id:g,__name:d.acctype+" "+g+" "+d.curr};__shouldProcess("accounts",g)&&processAccount(d,g);c.accounts.push(g)}}}
function processAccount(b,c){AnyBalance.trace("Обработка счета "+c.__name);getParam(b.acc,c,"accounts.num");getParam(b.acctype,c,"accounts.type");getParam(b.balance,c,"accounts.balance",null,null,parseBalance);getParam(b.balance,c,["accounts.currency","accounts.balance"],null,null,parseCurrency);getParam(b.date,c,"accounts.date_start",null,null,parseDateWord);var a=isAvailable("accounts.transactions"),d=new Date,g=new Date(d.getFullYear()-(a?5:0),d.getMonth(),d.getDate());a&&(b=AnyBalance.requestGet(baseurl+
"secure/ops.aspx?id="+b.benefacc+"&df="+fmtDate(g)+"&dt="+fmtDate(d),addHeaders({Referer:baseurl+"secure/accounts.aspx"})),isAvailable("cards.transactions")&&processAccountTransactions(b,c))}
function processAccountTransactions(b,c){AnyBalance.trace("Получаем все операции по счету...");var a=getElement(b,/<table[^>]+ophistory[^>]*>/i);a?(c.transactions=[],processTable(a,c.transactions,"accounts.transactions.",{date:{re:/Дата/i,result_func:parseDateSilent},descr:{re:/Детали платежа/i,result_process:function(a,b,c){getParam(b,c,a+"descr",/([\s\S]*?)(?:<table|<\/td>)/i,replaceTagsAndSpaces);getParam(b,c,a+"acc",/Cчет:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,c,
a+"payer",/Плательщик:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,c,a+"bank",/Банк:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,c,a+"category",/Категория:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)}},sum:{re:/Сумма/i,result_func:parseBalanceSilent},auth:{re:/Номер/i,result_func:null}})):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу операций по счету!"))}
function processCards(b,c){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"secure/dcards.aspx",g_headers);var a=getParam(b,null,null,/<table[^>]* class="prodlist"[^>]*>[^]*?<\/table>/i);if(a){if(a=getElements(a,[/<tr[^>]+product-cont/ig,/product-attr-name/i]),AnyBalance.trace("Найдено карт: "+a.length),AnyBalance.isAvailable("cards")&&(c.cards=[]),AnyBalance.isAvailable("cards")){(b=getParam(b,null,null,/var\s+carddata\s*=\s*(\[{[\s\S]*?}\])\s*;/i))&&(b=getJson(b));for(var d=
0;d<a.length;++d){var g=a[d],f=getElement(g,/<div[^>]+product-attr-title\s+mobile-view-block/i,replaceTagsAndSpaces),f={__id:f,__name:f};__shouldProcess("cards",f)&&processCard(g,f,b[d]);c.cards.push(f)}}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с картами.")}}
function processCard(b,c,a){var d=getElement(b,/<div[^>]+product-amount/i);b=getElement(d,/<div[^>]+f500/i,replaceTagsAndSpaces,parseBalance);d=getElement(d,/<sup[^>]+f500/i,replaceTagsAndSpaces,parseBalance);getParam(b+d/100,c,"cards.balance");getParam(a.currname,c,["cards.currency","cards.balance"]);getParam(a.cnum,c,"cards.cardnum");getParam(a.cardtype,c,"cards.type");getParam(a.cardstatus,c,"cards.status");getParam(a.cardenddate+"",c,"cards.till",null,replaceTagsAndSpaces,parseDateWord);getParam(a.cardacc+
"",c,"cards.acc_num");getParam(a.cardopendate+"",c,"cards.date_start",null,replaceTagsAndSpaces,parseDateWord);getParam(a.cardproduct+"",c,"cards.type_product");getParam(a.smsstatus+"",c,"cards.sms_status");getParam(a.smsphone+"",c,"cards.sms_phone");b=isAvailable("cards.transactions");var d=new Date,g=new Date(d.getFullYear()-(b?5:0),d.getMonth(),d.getDate());if(b||isAvailable("cards.needpay cards.gracepay cards.gracepaytill cards.pct cards.credit cards.limit".split(" ")))d=new Date,a=AnyBalance.requestGet(baseurl+
"secure/cops.aspx?id="+a.encSerno+"&df="+fmtDate(g,"/")+"&dt="+fmtDate(d,"/"),addHeaders({Referer:baseurl+"secure/dcards.aspx"})),getParam(a,c,"cards.blocked",/Неоплаченные авторизации:(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.pct",/Срочные проценты(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.credit",/Срочный Кредит(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.limit",/Платежный лимит:(?:[^>]*>){2}([^<]+)/i,
replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.needpay",/Обязательный платеж(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.gracepay",/Отчетная задолженность(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseBalance),getParam(a,c,"cards.gracepaytill",/Если Вы желаете воспользоваться условиями льготного кредитования([^<]+)/i,replaceTagsAndSpaces,parseDate),isAvailable("cards.transactions")&&processCardTransactions(c,a)}
function processCardTransactions(b,c){AnyBalance.trace("Получаем все операции по карте...");var a=getElement(c,/<table[^>]+viewsettingslist[^>]*>/i);a?(b.transactions=[],processTable(a,b.transactions,"cards.transactions.",{date:{re:/Дата(?:\s+|<[^>]*>)*транзакции/i,result_func:parseDateSilent},date_done:{re:/Дата(?:\s+|<[^>]*>)*проводки/i,result_func:parseDateSilent},descr:{re:/Содержание(?:\s+|<[^>]*>)*операции/i,result_process:function(a,b,c){getParam(b,c,a+"descr",/([\s\S]*?)(?:Категория:|<\/td>)/i,
replaceTagsAndSpaces);getParam(b,c,a+"category",/<span[^>]+operCatName[^>]*>[\s\S]*?<\/span>/i,replaceTagsAndSpaces)}},sum:{re:/Сумма(?:\s+|<[^>]*>)*в(?:\s+|<[^>]*>)*валюте(?:\s+|<[^>]*>)*операции/i,result_process:function(a,b,c){getParam(b,c,a+"sum",null,replaceTagsAndSpaces,parseBalanceSilent);getParam(b,c,a+"currency",null,replaceTagsAndSpaces,parseCurrencySilent)}},auth:{re:/код(?:\s+|<[^>]*>)*авто/i,result_func:null},sum_account:{re:/Сумма(?:\s+|<[^>]*>)*в(?:\s+|<[^>]*>)*валюте(?:\s+|<[^>]*>)*счета/i,
result_func:parseBalanceSilent}})):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу операций!"))}
function processDeposits(b,c){b=AnyBalance.requestGet(baseurl+"secure/deps.aspx",g_headers);var a=getParam(b,null,null,/<table[^>]*class="prodlist"[^>]*>[^]*?<\/table>/i);if(a){a=getElements(a,[/<tr[^>]+product-cont/ig,/product-attr-name/i]);AnyBalance.trace("Найдено депозитов: "+a.length);c.deposits=[];(b=getParam(b,/var\s+depdata\s*=\s*(\[{[\s\S]*?}\])\s*;/i))&&(b=getJson(b));for(var d=0;d<a.length;++d){var g=a[d],f=getElement(g,/<div[^>]+product-attr-name/i,replaceTagsAndSpaces),h=getElement(g,
/<td[^>]+\bt2/i,replaceTagsAndSpaces),f={__id:f,__name:h};__shouldProcess("deposits",f)&&processDeposit(g,f,b[d]);c.deposits.push(f)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с депозитами.")}
function processDeposit(b,c,a){getParam(b,c,"deposits.status",/<td[^>]*CurrentStatus[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a.db,c,"deposits.balance",null,replaceTagsAndSpaces,parseBalance);getParam(a.db,c,["deposits.currency","deposits.balance"],null,replaceTagsAndSpaces,parseCurrency);getParam(a.dr,c,"deposits.pct",null,replaceTagsAndSpaces,parseBalance);getParam(a.ac,c,"deposits.acc_num",null,replaceTagsAndSpaces);getParam(a.ddd,c,"deposits.period",null,replaceTagsAndSpaces);getParam(a.od,
c,"deposits.date_start",null,replaceTagsAndSpaces,parseDateWord);getParam(a.de,c,"deposits.date_end",null,replaceTagsAndSpaces,parseDateWord);getParam(a.cap,c,"deposits.pct_condition");getParam(a.unitcode,c,"deposits.pct_period");getParam(a.dmil,c,"deposits.balance_min",null,[replaceTagsAndSpaces,/-|любая/i,0],parseBalance);getParam(a.dmsi,c,"deposits.topup_min",null,[replaceTagsAndSpaces,/-|любая/i,0],parseBalance);getParam(a.dmal,c,"deposits.balance_max",null,replaceTagsAndSpaces,parseBalance);
b=isAvailable("deposits.transactions");var d=new Date,g=new Date(d.getFullYear()-(b?5:0),d.getMonth(),d.getDate());b&&(b=AnyBalance.requestGet(baseurl+"secure/depsops.aspx?id="+a.nm+"&df="+fmtDate(g)+"&dt="+fmtDate(d),addHeaders({Referer:baseurl+"secure/accounts.aspx"})),isAvailable("deposits.transactions")&&processDepositTransactions(b,c))}
function processDepositTransactions(b,c){AnyBalance.trace("Получаем все операции по депозиту...");var a=getElement(b,/<table[^>]+ophistory[^>]*>/i);a?(c.transactions=[],processTable(a,c.transactions,"deposits.transactions.",{date:{re:/Дата/i,result_func:parseDateSilent},descr:{re:/Детали платежа/i,result_process:function(a,b,c){getParam(b,c,a+"descr",/([\s\S]*?)(?:<table|<\/td>)/i,replaceTagsAndSpaces);getParam(b,c,a+"acc",/Cчет:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,
c,a+"payer",/Плательщик:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,c,a+"bank",/Банк:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,c,a+"category",/Категория:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)}},sum:{re:/Сумма/i,result_func:parseBalanceSilent},auth:{re:/Номер/i,result_func:null}})):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу операций по депозиту!"))}
function processLoans(b,c){if(AnyBalance.isAvailable("loans")){b=AnyBalance.requestGet(baseurl+"secure/loans.aspx",g_headers);var a=getParam(b,null,null,/<table[^>]*class="prodlist"[^>]*>[^]*?<\/table>/i);if(a){a=getElements(a,[/<tr/ig,/product-attr-name/i]);AnyBalance.trace("Найдено кредитов: "+a.length);c.loans=[];var d=getParam(b,/var\s+loanDetailsData\s*=\s*(\[{[\s\S]*?}\])/i,null,getJson),g=getParam(b,/var\s+loanHistoryData\s*=\s*(\[{[\s\S]*?}\])/i,null,getJson);b=getParam(b,/var\s+loanFuturePaymentsData\s*=\s*(\[{[\s\S]*?}\])/i,
null,getJson);for(var f=0;f<a.length;++f){var h=getElement(a[f],/<div[^>]+product-attr-name/i,replaceTagsAndSpaces),u=getElement(a[f],/<div[^>]+product-attr-title/i,replaceTagsAndSpaces),z=getParam(d[f].dt,c,"loans.acc_num",/Лицевой счет №:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces),h={__id:h,__name:u,acc_num:z};__shouldProcess("loans",h)&&(processLoan(a[f],h,d[f]),AnyBalance.isAvailable("loans.transactions")&&processLoanTransactions(g[f],h),AnyBalance.isAvailable("loans.schedule")&&processLoanSchedule(b[f],
h));c.loans.push(h)}}else/У Вас нет кредитов/i.test(b)?AnyBalance.trace("Нет ни одного кредита."):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с кредитами."))}}
function parseSum(b,c,a){getParam(c,a,b+this._prefix+"sum",/<div[^>]+class="summ"[^>]*>([^]*?)<\/div>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(c,a,b+this._prefix+"debt",/Погашение основного долга[^]*?<td[^>]*>([^]*?)<\/td>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(c,a,b+this._prefix+"pct",/Погашение процентов[^]*?<td[^>]*>([^]*?)<\/td>/i,replaceTagsAndSpaces,parseBalanceSilent)}
function processLoanTransactions(b,c){AnyBalance.trace("Получаем все операции по кредиту "+c.__name);var a=b.his;a?(c.transactions=[],processTable(a,c.transactions,"loans.transactions.",{date:{re:/Дата/i,result_func:parseDateSilent},min_sum:{re:/Минимальная сумма погашения/i,_prefix:"min_",result_process:parseSum},sum:{re:/Фактически внесено/i,result_func:parseBalanceSilent},fact_sum:{re:/Фактически погашено/i,_prefix:"fact_",result_process:parseSum}})):(AnyBalance.trace(JSON.stringify(b)),AnyBalance.trace("Не удалось найти таблицу операций по кредиту!"))}
function processLoanSchedule(b,c){AnyBalance.trace("Получаем расписание платежей по кредиту "+c.__name);var a=b.fut;a?(c.schedule=[],processTable(a,c.schedule,"loans.schedule.",{date:{re:/Дата/i,result_func:parseDateWordSilent},details:{re:/В том числе/i,_prefix:"",result_process:parseSum},sum:{re:/Сумма платежа/i}})):(AnyBalance.trace(JSON.stringify(b)),AnyBalance.trace("Не удалось найти расписание платежей по кредиту!"))}
function parsePcts(b){var c=sumParam(b,null,null,/c\s*\d+\D\d+\D\d+\s*-\s*[\d.,]+%/ig);if(c){b=new Date;for(var a=c.length-1;0<=a;a--){var d=getParam(c[a],null,null,/\d+\D\d+\D\d+/,null,parseDate);if(b.getTime()>=d)return getParam(c[a],null,null,/[\d.,]+%/i,null,parseBalance)}}else return parseBalance(b)}function parseBool(b){return!/нет/i.test(b)}
function processLoan(b,c,a){AnyBalance.trace("Обработка кредита "+c.__id);getParam(a.dt,c,"loans.limit",/Общая сумма кредита:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,["loans.currency","loans.balance","loans.minpay","loans.limit"],/Общая сумма кредита:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseCurrency);getParam(a.dt,c,"loans.minpay",/Сумма ближайшего платежа:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,"loans.minpaydate",/Дата ближайшего платежа:?([\s\S]*?)<\/li>/i,
replaceTagsAndSpaces,parseDateWord);getParam(a.dt,c,"loans.penalty",/Просроченная задолженность по кредиту:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,"loans.acc_num",/Лицевой счет №:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces);getParam(a.dt,c,"loans.pct",/Текущая процентная ставка по кредиту:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parsePcts);getParam(a.dt,c,"loans.date_start",/Дата выдачи:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseDateWord);getParam(a.dt,c,"loans.date_end",
/Дата финального погашения:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseDateWord);getParam(a.dt,c,"loans.period",/Срок кредита:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,"loans.balance",/Текущая сумма долга по кредиту:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,"loans.sum_close",/Сумма[^<]*под закрытие договора[^<]*:?([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(a.dt,c,"loans.noclose",/Мораторий на погашение по кредиту:?([\s\S]*?)<\/li>/i,
replaceTagsAndSpaces,parseBool)}function initCols(b,c){for(var a={},d=0;d<c.length;d++){var g=c[d],f;for(f in b)b[f].re.test(replaceAll(g,[replaceTagsAndSpaces,replaceHtmlEntities]))&&(a[f]=d)}return a}
function fillColsResult(b,c,a,d,g){function f(a,b){return isset(a)?a:b}g=g||"";var h=replaceTagsAndSpaces,u=parseBalance,z=aggregate_sum,q;for(q in b){var k=b[q];if(isset(c[q])){var l=a[c[q]],v=f(k.result_name,q);if(isArray(v)){for(var H=[],B=0;B<v.length;B++)H.push(g+v[B]);v=H}else v=g+v;k.result_process?k.result_process(g,l,d):k.result_sum?(k.result_re&&(k.result_re.lastIndex=0),sumParam(l,d,v,k.result_re,f(k.result_replace,h),f(k.result_func,u),f(k.result_aggregate,z))):getParam(l,d,v,k.result_re,
f(k.result_replace,h),f(k.result_func,u))}}}function processTable(b,c,a,d,g,f){b=getElements(b,/<tr[^>]*>/ig);for(var h,u,z=0;z<b.length;z++){var q=b[z],k=getElements(q,/<td[^>]*>/ig);0==k.length?(h=getElements(q,/<th[^>]*>/ig),u=h.length,h=initCols(d,h)):k.length==u?(q={},fillColsResult(d,h,k,q,a),f&&f(q,a),c.push(q)):g&&g(q,k)}}
function processInfo(b){var c=AnyBalance.requestGet(baseurl+"secure/InformingSettings/OperationsInSystem.aspx",g_headers);b=b.info={};getParam(c,b,"fio",/<div[^>]+id="statfio"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(c,b,"mphone",/<input[^>]+name="[^"]*txtMobileNumber"[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(c,b,"email",/<input[^>]+name="[^"]*txtNotificationEmail"[^>]*value="([^"]*)/i,replaceHtmlEntities)}
function processBonus(b){if(AnyBalance.isAvailable("bonuses")){var c=AnyBalance.requestPost(baseurl+"secure/Main.aspx/GetBonusInfo","{}",addHeaders({Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/json; charset=UTF-8",Referer:baseurl+"secure/main.aspx","X-Requested-With":"XMLHttpRequest"})),c=getJson(getJson(c).d);getParam(c.AscBonus,b,"bonuses")}};
